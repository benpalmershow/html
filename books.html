<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Books</title>
    <link rel="stylesheet" href="css/body.css">
    <link rel="stylesheet" href="css/books.css">
</head>
<body>
    <header class="site-header">
      <div class="logo-container">
        <a href="index.html">
          <img src="images/logo.png" alt="Howdy Stranger" class="logo" loading="lazy">
        </a>
      </div>
    </header>
    <nav class="nav-links" id="main-nav"></nav>
    <div class="book-filters">
      <img src="images/read.png" alt="Read Logo" class="book-filters-logo" loading="lazy">
      <label>Rating:
        <select id="filter-thumbs">
          <option value="all">All</option>
          <option value="up">üëç Up</option>
          <option value="down">üëé Down</option>
        </select>
      </label>
      <label>Year:
        <select id="filter-date">
          <option value="all">All</option>
        </select>
      </label>
      <label>Genre:
        <select id="filter-genre">
          <option value="all">All</option>
        </select>
      </label>
    </div>
    <div class="book-cards" id="book-cards"></div>
    <script>
      fetch('json/books.json')
        .then(response => response.json())
        .then(books => {
          const container = document.getElementById('book-cards');
          const thumbsSelect = document.getElementById('filter-thumbs');
          const dateSelect = document.getElementById('filter-date');
          const genreSelect = document.getElementById('filter-genre');

          // Populate year and genre filters
          const years = Array.from(new Set(books.map(b => b.date))).sort((a,b) => b.localeCompare(a));
          years.forEach(y => {
            const opt = document.createElement('option');
            opt.value = y;
            opt.textContent = y;
            dateSelect.appendChild(opt);
          });
          const genres = Array.from(new Set(books.map(b => b.genre))).sort();
          genres.forEach(g => {
            const opt = document.createElement('option');
            opt.value = g;
            opt.textContent = g;
            genreSelect.appendChild(opt);
          });

          const genreColors = {
            'Finance': 'var(--bg-primary)',
            'Programming': 'var(--bg-secondary)',
            'Politics': 'var()',
            'Economics': 'var()',
            'Technology': 'var()',
            'Self-Help': '#fffbe6', // a light yellow, fallback if needed
            // fallback
            'default': 'var(--bg-primary)'
          };

          function render(filtered) {
            container.innerHTML = '';
            filtered.forEach((book) => {
              const card = document.createElement('div');
              card.className = 'book-card';
              card.style.background = genreColors[book.genre] || genreColors['default'];
              card.innerHTML = `
                ${book.tag ? `<div class="book-tag">${book.tag}</div>` : ''}
                <div class="book-thumb">${book.thumbs === 'up' ? 'üëç' : ''}</div>
                <div class="book-title">${book.title}</div>
                <div class="book-author"><strong>Author:</strong> ${book.author}</div>
                <div class="book-date"><strong>Year:</strong> ${book.date}</div>
                <div class="book-genre"><strong>Genre:</strong> ${book.genre}</div>
                <div class="book-desc"><strong>Description:</strong> ${book.description}</div>
                <a href="${book.link}" target="_blank" rel="noopener noreferrer" class="book-link">Link to Book</a>
              `;
              container.appendChild(card);
            });
          }

          function filterBooks() {
            let filtered = books;
            const thumbs = thumbsSelect.value;
            const year = dateSelect.value;
            const genre = genreSelect.value;
            if (thumbs !== 'all') filtered = filtered.filter(b => b.thumbs === thumbs);
            if (year !== 'all') filtered = filtered.filter(b => b.date === year);
            if (genre !== 'all') filtered = filtered.filter(b => b.genre === genre);
            render(filtered);
          }

          thumbsSelect.addEventListener('change', filterBooks);
          dateSelect.addEventListener('change', filterBooks);
          genreSelect.addEventListener('change', filterBooks);

          render(books);
        });
    </script>
    <script src="/js/nav.js" defer></script>
    <script src="/js/read-nav.js?v=3.1" defer></script>
</body>
</html>