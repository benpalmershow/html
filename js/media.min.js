 document.addEventListener('DOMContentLoaded',function(){const mediaContainer=document.getElementById('media-cards-container');const filterType=document.getElementById('filter-type');const sortBy=document.getElementById('sort-by');let mediaItems=[];function getUniqueMediaTypes(items){const types=new Set();items.forEach(item=>{if(item.mediaType){types.add(item.mediaType);}});return Array.from(types).sort();}function populateFilterDropdown(types){const filterType=document.getElementById('filter-type');while(filterType.options.length>1){filterType.remove(1);}types.forEach(type=>{const option=document.createElement('option');option.value=type;option.setAttribute('aria-label',`Filter by ${type}`);option.textContent=type.charAt(0).toUpperCase()+type.slice(1)+'s';filterType.appendChild(option);});}const CACHE_KEY='media-data-cache';const CACHE_DURATION=5*60*1000;async function fetchMediaData(){mediaContainer.innerHTML='<div class="loading-state"><i class="fas fa-spinner fa-spin"></i>Loading media...</div>';try{const cached=localStorage.getItem(CACHE_KEY);if(cached){const{data,timestamp}=JSON.parse(cached);if(Date.now()-timestamp<CACHE_DURATION){mediaItems=data;initializeMediaDisplay();return;}}const __v=(document.querySelector('meta[name="last-commit"]')&&document.querySelector('meta[name="last-commit"]').getAttribute('content'))||Date.now(); const response=await fetch(`json/media.json?v=${encodeURIComponent(__v)}`);if(!response.ok){if(response.status===404){throw new Error('Media data file not found');}else if(response.status>=500){throw new Error('Server error occurred');}else{throw new Error(`Failed to fetch media data(${response.status})`);}} mediaItems=await response.json();mediaItems=mediaItems.filter(validateMediaItem);localStorage.setItem(CACHE_KEY,JSON.stringify({data:mediaItems,timestamp:Date.now()}));initializeMediaDisplay();}catch(error){console.error('Error loading media data:',error);let errorMessage='Error loading media.';if(error.name==='TypeError'){errorMessage+='Please check your internet connection.';}else{errorMessage+=error.message;}mediaContainer.innerHTML=`<div class="error-state"><i class="fas fa-exclamation-triangle"></i><p>${errorMessage}</p><button onclick="location.reload()" class="retry-button">Try Again</button></div>`;}}function initializeMediaDisplay(){const mediaTypes=getUniqueMediaTypes(mediaItems);populateFilterDropdown(mediaTypes);if(sortBy){sortBy.value='date-desc';}filterAndSortMedia();}function validateMediaItem(item){const VALID_MEDIA_TYPES=['movie','book','podcast','playlist','song','video','article'];return item&&item.title&&item.mediaType&&VALID_MEDIA_TYPES.includes(item.mediaType);}function renderMediaCards(items){mediaContainer.innerHTML='';if(items.length===0){mediaContainer.innerHTML='<p>No media items found.</p>';return;}items.forEach(item=>{const card=createMediaCard(item);mediaContainer.appendChild(card);});}function createMediaCard(item){const card=document.createElement('div');card.className='media-card';card.setAttribute('data-media-type',item.mediaType||'unknown');card.setAttribute('role','article');card.setAttribute('aria-label',`${item.title}-${item.mediaType}`);card.setAttribute('tabindex','0');const coverContainer=document.createElement('div');coverContainer.className='media-cover-container';const coverImg = document.createElement('img');
coverImg.className = 'media-cover';

// Set explicit dimensions to prevent layout shifts
coverImg.width = 300;
coverImg.height = 200;

// Set alt text
const altText = item.title ? `Cover image for ${item.title}` : 'Media cover image';
coverImg.alt = altText;

// Use a placeholder initially
coverImg.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMzAwIDIwMCI+CiAgPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI0Q4RDhEOCIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM2NjYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5Mb2FkaW5nLi4uPC90ZXh0Pgo8L3N2Zz4=';

// Load the actual image
if (item.cover) {
  const img = new Image();
  img.src = item.cover;
  img.onload = function() {
    coverImg.src = item.cover;
    coverImg.classList.add('loaded');
  };
  img.onerror = function() {
    coverImg.src = 'https://via.placeholder.com/300x200/2C5F5A/FFFFFF?text=No+Image';
  };
} else {
  coverImg.src = 'https://via.placeholder.com/300x200/2C5F5A/FFFFFF?text=No+Image';
  coverImg.classList.add('loaded');
}const typeBadge=document.createElement('div');typeBadge.className='media-type';const typeIcon=document.createElement('i');typeIcon.className=getMediaTypeIcon(item.mediaType);typeBadge.appendChild(typeIcon);if(item.status&&item.status.toLowerCase()==='reading now'){const readingNowBadge=document.createElement('div');readingNowBadge.className='reading-now-badge';readingNowBadge.textContent='Reading Now';coverContainer.appendChild(readingNowBadge);}if(item.featured){const featuredBadge=document.createElement('div');featuredBadge.className='media-featured';featuredBadge.textContent=item.featured;coverContainer.appendChild(featuredBadge);}const overlay=document.createElement('div');overlay.className='media-overlay';const overlayContent=document.createElement('div');overlayContent.className='media-overlay-content';const title=document.createElement('h3');title.className='media-title';title.textContent=item.title;overlayContent.appendChild(title);if(item.author){const author=document.createElement('div');author.className='media-author';if(item.mediaType==='movie'){author.textContent=item.author?`Director:${item.author}`:'';}else if(item.mediaType==='playlist'){author.textContent=item.author?`Curator: ${item.author}`:'';}else{author.textContent=item.author;}overlayContent.appendChild(author);}if(item.description){const description=document.createElement('div');description.className='media-description';description.textContent=item.description;overlayContent.appendChild(description);}if(item.mediaType==='movie'){const movieActionsContainer=document.createElement('div');movieActionsContainer.className='movie-actions-container';if(item.ratings){if(item.ratings.rt){const rtLink=document.createElement('a');rtLink.href=item.ratings.rt.url;rtLink.className='rating-logo rt-logo';rtLink.target='_blank';rtLink.rel='noopener noreferrer';const tomatoSpan=document.createElement('span');tomatoSpan.className='rt-tomato';tomatoSpan.textContent='üçÖ';const scoreSpan=document.createElement('span');scoreSpan.className='score';scoreSpan.textContent=item.ratings.rt.score;rtLink.appendChild(tomatoSpan);rtLink.appendChild(document.createTextNode(' '));rtLink.appendChild(scoreSpan);movieActionsContainer.appendChild(rtLink);}if(item.ratings.imdb){const imdbLink=document.createElement('a');imdbLink.href=item.ratings.imdb.url;imdbLink.className='rating-logo imdb-logo';imdbLink.target='_blank';imdbLink.rel='noopener noreferrer';const imdbSpan=document.createElement('span');imdbSpan.className='imdb-icon';imdbSpan.textContent='IMDb';const scoreSpan=document.createElement('span');scoreSpan.className='score';scoreSpan.textContent=item.ratings.imdb.score;imdbLink.appendChild(imdbSpan);imdbLink.appendChild(document.createTextNode(' '));imdbLink.appendChild(scoreSpan);movieActionsContainer.appendChild(imdbLink);}}if(item.embedUrl){const trailerContainer=document.createElement('div');trailerContainer.className='trailer-container-inline';const trailerButton=document.createElement('button');trailerButton.className='trailer-button-inline';trailerButton.setAttribute('title','Watch Trailer');const buttonIcon=document.createElement('i');buttonIcon.className='fab fa-youtube';trailerButton.appendChild(buttonIcon);trailerButton.addEventListener('click',function(e){e.stopPropagation();const existingTrailer=overlayContent.querySelector('.trailer-embed');if(existingTrailer){overlayContent.removeChild(existingTrailer);trailerButton.innerHTML='';const resetIcon=document.createElement('i');resetIcon.className='fab fa-youtube';trailerButton.setAttribute('title','Watch Trailer');trailerButton.appendChild(resetIcon);return;}const trailerEmbed=document.createElement('div');trailerEmbed.className='trailer-embed';const iframe=document.createElement('iframe');iframe.width='100%';iframe.height='100%';iframe.src=item.embedUrl;iframe.title=`${item.title}Trailer`;iframe.setAttribute('frameborder','0');iframe.allow='accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture';iframe.allowFullscreen=true;trailerEmbed.appendChild(iframe);overlayContent.appendChild(trailerEmbed);trailerButton.innerHTML='';const closeIcon=document.createElement('i');closeIcon.className='fas fa-times';trailerButton.setAttribute('title','Close Trailer');trailerButton.appendChild(closeIcon);});trailerContainer.appendChild(trailerButton);movieActionsContainer.appendChild(trailerContainer);}overlayContent.appendChild(movieActionsContainer);}if(item.mediaType==='playlist'&&item.embedUrl){const trailerContainer=document.createElement('div');trailerContainer.className='trailer-container';const trailerButton=document.createElement('button');trailerButton.className='trailer-button';trailerButton.setAttribute('title','Preview Playlist');trailerButton.classList.add('playlist-button');const buttonIcon=document.createElement('i');buttonIcon.className='fab fa-youtube';trailerButton.appendChild(buttonIcon);trailerButton.addEventListener('click',function(e){e.stopPropagation();const existingTrailer=trailerContainer.querySelector('.trailer-embed');if(existingTrailer){trailerContainer.removeChild(existingTrailer);trailerButton.innerHTML='';const resetIcon=document.createElement('i');resetIcon.className='fab fa-youtube';trailerButton.setAttribute('title','Preview Playlist');trailerButton.appendChild(resetIcon);return;}const trailerEmbed=document.createElement('div');trailerEmbed.className='trailer-embed';const iframe=document.createElement('iframe');iframe.width='100%';iframe.height='100%';iframe.src=item.embedUrl;iframe.title=`${item.title}Trailer`;iframe.setAttribute('frameborder','0');iframe.allow='accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture';iframe.allowFullscreen=true;trailerEmbed.appendChild(iframe);trailerContainer.appendChild(trailerEmbed);trailerButton.innerHTML='';const closeIcon=document.createElement('i');closeIcon.className='fas fa-times';trailerButton.setAttribute('title','Close Trailer');trailerButton.appendChild(closeIcon);});trailerContainer.appendChild(trailerButton);overlayContent.appendChild(trailerContainer);}if(item.rating){const rating=document.createElement('div');rating.className='media-rating';const stars='‚òÖ'.repeat(Math.round(item.rating))+'‚òÜ'.repeat(5-Math.round(item.rating));rating.textContent=stars;overlayContent.appendChild(rating);}if(item.links&&item.links.length>0){const linksContainer=document.createElement('div');if(item.mediaType==='song'||item.mediaType==='podcast'||item.mediaType==='playlist'){linksContainer.className=item.mediaType==='song'?'song-links':'podcast-links';item.links.forEach(link=>{if(link.icon){const linkEl=document.createElement('a');linkEl.href=link.url;linkEl.className=item.mediaType==='song'?'song-link':'podcast-link';linkEl.target='_blank';linkEl.rel='noopener noreferrer';linkEl.setAttribute('title',link.label);if(link.icon.includes('spotify'))linkEl.classList.add('spotify-link');else if(link.icon.includes('apple'))linkEl.classList.add('apple-link');else if(link.icon.includes('youtube'))linkEl.classList.add('youtube-link');else if(link.icon.includes('soundcloud'))linkEl.classList.add('soundcloud-link');else if(link.icon.includes('amazon'))linkEl.classList.add('amazon-link');else if(link.icon.includes('google'))linkEl.classList.add('google-link');else if(link.icon.includes('rss'))linkEl.classList.add('rss-link');const linkIcon=document.createElement('i');linkIcon.className=link.icon;linkEl.appendChild(linkIcon);linksContainer.appendChild(linkEl);}});}else{linksContainer.className='media-links';item.links.forEach(link=>{const linkEl=document.createElement('a');linkEl.href=link.url;linkEl.className='media-link';linkEl.target='_blank';linkEl.rel='noopener noreferrer';if(link.icon){const linkIcon=document.createElement('i');linkIcon.className=link.icon;linkEl.appendChild(linkIcon);linkEl.appendChild(document.createTextNode(' '+link.label));}else{linkEl.textContent=link.label;}linksContainer.appendChild(linkEl);});}overlayContent.appendChild(linksContainer);}// Date display removed as per user request
        overlay.appendChild(overlayContent);card.addEventListener('keydown',function(e){if(e.key==='Enter'||e.key===' '){e.preventDefault();card.classList.add('keyboard-focus');setTimeout(()=>card.classList.remove('keyboard-focus'),200);}});coverContainer.appendChild(coverImg);coverContainer.appendChild(typeBadge);card.appendChild(coverContainer);card.appendChild(overlay);return card;}const MEDIA_TYPE_ICONS={'podcast':'fas fa-podcast','playlist':'fas fa-music','book':'fas fa-book','song':'fas fa-music','video':'fas fa-video','movie':'fas fa-film','article':'fas fa-newspaper'};function getMediaTypeIcon(mediaType){return MEDIA_TYPE_ICONS[mediaType]||'fas fa-file-alt';}function formatDate(dateString){if(!dateString)return '';const date=parseDateString(dateString);if(!date){return dateString;}return date.toLocaleDateString('en-US',{year:'numeric',month:'long'});}function parseDateString(dateString){if(!dateString)return null;const monthYearRegex=/^([A-Za-z]+)\s+(\d{4})$/;const match=dateString.match(monthYearRegex);if(match){const monthNames=["january","february","march","april","may","june","july","august","september","october","november","december"];const monthName=match[1].toLowerCase();const year=parseInt(match[2]);let monthIndex=-1;for(let i=0;i<monthNames.length;i++){if(monthNames[i].startsWith(monthName.substring(0,3))){monthIndex=i;break;}}if(monthIndex!==-1){return new Date(year,monthIndex,1);}}let date=new Date(dateString);if(!isNaN(date.getTime())){return date;}return null;}function filterAndSortMedia(){const typeFilter=filterType.value;const sortValue=sortBy.value;let filtered=[...mediaItems];if(typeFilter!=='all'){filtered=filtered.filter(item=>item.mediaType===typeFilter);}filtered.sort((a,b)=>{
switch(sortValue){
case 'date-asc':
const dateA=parseDateString(a.dateAdded)||parseDateString(a.date)||new Date(0);
const dateB=parseDateString(b.dateAdded)||parseDateString(b.date)||new Date(0);
return dateA.getTime()-dateB.getTime();
case 'date-desc':
const dateC=parseDateString(a.dateAdded)||parseDateString(a.date)||new Date(0);
const dateD=parseDateString(b.dateAdded)||parseDateString(b.date)||new Date(0);
return dateD.getTime()-dateC.getTime();
case 'newest-added':
const dateE=parseDateString(a.dateAdded)||new Date(0);
const dateF=parseDateString(b.dateAdded)||new Date(0);
return dateF.getTime()-dateE.getTime();
case 'title-asc':return (a.title||'').localeCompare(b.title||'');case 'title-desc':return (b.title||'').localeCompare(a.title||'');default:return 0;}});renderMediaCards(filtered);updateResultsCount(filtered.length,mediaItems.length);}function updateResultsCount(filteredCount,totalCount){let existingCount=document.querySelector('.results-count');if(existingCount){existingCount.remove();}if(filteredCount!==totalCount){const countDisplay=document.createElement('div');countDisplay.className='results-count';let countText=`Showing ${filteredCount}of ${totalCount}items`;const activeFilter=filterType.value;if(activeFilter!=='all'){const filterText=activeFilter.charAt(0).toUpperCase()+activeFilter.slice(1)+'s';countText+=` in ${filterText}`;}countDisplay.textContent=countText;const filtersContainer=document.querySelector('.media-filters');filtersContainer.insertAdjacentElement('afterend',countDisplay);}}filterType.addEventListener('change',filterAndSortMedia);sortBy.addEventListener('change',filterAndSortMedia);fetchMediaData();});